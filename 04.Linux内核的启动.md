# Linux内核的启动

-   [启动消息](#启动消息)
-   [内核初始化和启动选项](#内核初始化和启动选项)
-   [内核参数](#内核参数)
-   [引导装载程序](#引导装载程序)
    -   [引导装载程序任务](#引导装载程序任务)
    -   [引导装载程序概述](#引导装载程序概述)
-   [GRUB简介](#GRUB简介)
-   [参考](#参考)

------

## 启动消息

传统的Unix系统在启动时会显示很多系统信息，方便你查看启动过程。这些消息一开始来自 内核，然后是进程和init执行的初始化程序。然而，这些消息格式不是那么清晰和一致，有时甚至不是那么有用。现在大部分Linux发行版都使用启动屏幕、屏幕填充色和启动选项菜单将它们 遮盖住。此外，硬件性能的提升也让启动过程更快，这些消息显示得也更快，快到让人难以捕捉。

有两种方法可以查看内核启动信息和运行时的诊断信息。

-   查看内核系统日志文件。这些文件通常存放在/var/log/kern.log中，取决于你的系统配置，也可能和其他系统日志一起存放在/var/log/messages或者别的地方。
-   使用dmesg命令，不过记得将结果输出到less，因为信息量会比较大。dmesg命令使用内核 环缓冲区，它的容量有限，不过大多数较新的内核能够有足够的空间来容纳足够长的启动日志。

```bash
$ dmesg
[ 0.000000] Initializing cgroup subsys cpu
[ 0.000000] Linux version 3.2.0-67-generic-pae (buildd@toyol) (gcc version 4. 6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5) ) #101-Ubuntu SMP Tue Jul 15 18:04:54 UTC 2014
(Ubuntu 3.2.0-67.101-generic-pae 3.2.60)
[ 0.000000] KERNEL supported cpus: --snip--
[ 2.986148] sr0: scsi3-mmc drive: 24x/8x writer dvd-ram cd/rw xa/form2 cdda tray
[ 2.986153] cdrom: Uniform CD-ROM driver Revision: 3.20
[ 2.986316] sr 1:0:0:0: Attached scsi CD-ROM sr0
[ 2.986416] sr 1:0:0:0: Attached scsi generic sg1 type 5
[ 3.007862] sda: sda1 sda2 < sda5 >
[ 3.008658] sd 0:0:0:0: [sda] Attached SCSI disk
```

## 内核初始化和启动选项

在启动时，Linux内核的初始化过程如下: 

1.  检查CPU;
2.  检查内存;
3.  检测设备总线;
4.  检测设备;
5.  设置附加内核子系统(如网络等);
6.  挂载root目录;
7.  启动用户空间。 

前面几个步骤很好理解，设备相关的步骤则涉及一些依赖性问题。例如磁盘设备驱动程序可能需要依赖于总线和SCSI子系统的支持。

## 内核参数

运行Linux内核的时候，引导装载程序会向内核传递一系列文本形式的内核参数来设定内核 的启动方式。这些参数设定了很多不同的行为方式，比如内核显示的诊断信息的多少、设备驱动 程序相关参数等。

你可以通过/proc/cmdline文件来查看系统启动时使用的内核参数:

```bash
$ cat /proc/cmdline
BOOT_IMAGE=/boot/vmlinuz-3.2.0-67-generic-pae root=UUID=70ccd6e7-6ae6-44f6-
812c-51aab8036d29 ro quiet splash vt.handoff=7
```

## 引导装载程序

在启动过程的最开始，引导装载程序启动内核，然后内核和init启动。引导装载程序的工作 看似很简单:将内核加载到内存，然后使用一系列内核参数启动内核。但是关于引导装载程序， 需要弄清楚下面两个问题。

-   内核在哪里?
-   内核启动时需要传递哪些参数?

>   答案是:内核及其参数(通常是)在root文件系统中。因为内核此时还没有开始运行，无法 遍历文件系统，所以内核参数需要被放到一个容易存取的地方。并且此时用于访问磁盘的内核设 备驱动还没有准备好，这听起来有点像“鸡生蛋，蛋生鸡”。

### 引导装载程序任务

Linux引导装载程序的核心功能如下:

-   从多个内核中选择一个使用;
-   从多个内核参数集中选择一个使用;
-   允许用户手动更改内核映像名和参数(例如使用单用户模式);  支持其他操作系统的启动。

### 引导装载程序概述

以下是一些常见的引导装载程序，按照普及的顺序排列。

-   GRUB:近乎于Linux系统标准。
-   LILO:最早期的Linux引导装载程序之一，是UEFI的一个版本。
-   SYSLINUX:能够在很多不同的文件系统上配置和启动。 3  LOADLIN:能够从MS-DOS上启动内核。
-   efilinux:UEFI引导装载程序的一种，作为其他UEFI引导装载程序的模块和引用。
-   coreboot(以前又叫作LinuxBIOS):PC BIOS的高性能替代品，并且能够包含内核。
-   Linux Kernel EFISTUB:能够从EFI/UEFI系统分区(ESP)加载内核的一个内核插件。

## GRUB简介

参考精通linux(第二版)

## 参考

[精通linux(第二版)](https://www.ituring.com.cn/book/1548)